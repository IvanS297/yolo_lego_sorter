# yolo_lego_sorter
В этом проекте используется фреймворк yolo v8
Для того чтобы запустить процесс сортировки деталей нужно:
  1. Установить Python 3.10.x.
  2. Установить Arduino IDE.
  3. Установить среду разработки (Любую IDE, подходящую для Python), но этот шаг можно не делать.
  4. Перейти в IDE для Python и активировать виртуальное акружение.
  5. Установить все неюбходимые библиотеки, при помощи команды pip3 install -r requirements
  6. Перенести файл Lego_Sorter_v0.1.ino в папку для Arduino скетчей.
  7. Установить все необходимые библиотеки для скетча через "Менеджер библиотек"
  8. Запустить файл .ino, посмотреть или отредактировать все константы #define под себя (если это необходимо), выбрать платы Arduino Nano с Old Bootloader, загрузить скетч.
  9. Спаять/Собрать схему для сортировщика.
  10. Убедившись что предыдущие шаги были выполнены, запустить файл yolo_predict.py (перед этим надо подключить Web-камеру с разрешением не мение чем 480p)

Разбор файлов .conf:
   1. serial.conf:
      1. port - COM порт, по которому Arduino будет общаться с компьютером.
      2. port_baudrate - Скорость общения Arduino с компьютером в бодах (В этом проекте достаточно будет 9600).
      3. rotate_motor_key - ключ, по которому Python будет отправлять количество градусов для поворота барабана.
      4. move_motor_key - ключ, по которому Python будет отправлять количество градусов для поворота "сдвигателя".
      5. conveyor_motor_key - ключ, по которому Python будет отправлять состояние вращения для ковеера.
      6. lcd_key - ключ, по которому Python будет отправлять название детали, распознанной нейросетью.
      7. conveyor_motor_speed - скорость ковеера.
      8. buzz_signal_delay - время, в течение которого пьезоизлучатель будет издавать писк (в миллисекундах).
   2. img_action.conf:
      1. scale_percent - процент сжатия изображения пр фотографировании (для облегчения распознаваниях).
      2. thresh - порог, при котором цвета станут белыми.
      3. bright - яркость белого цвета.
      4. a и b менять не нужно.
   3. degrees.conf:
      1. brick = 0                    \
      2. plate = 45                   |
      3. technic_pin_connector = 90   |
      4. technic_pin = 135            > - количество градусов для каждой детальки.
      5. vehicle_mudguard = 180       |
      6. gear = 225                   |
      7. (no_detections) = 270        /
      8. step - шаг (разница между двумя любыми последовательными деталями в списке).
      9. seconds_per_step - за сколько секунд прокручивается один шаг.
      10. seconds_per_move - за сколько секунд сдвигается деталька с предметного столика.

Краткий разбор файлов .py:
  1. image_actions.py:
     Подключаются библиотеки cv2 и ConfigParser.
     Дальше идут три функции:
       1. resize_img(input_img) - функция для сжатия изображения по scale_percent. Аргумент input_img - изображения для махинаций.
       2. img_to_gray(inoput_img) - функция для перевода цветного изображения в серо-чёрно-белое.
       3. img_to_binary(input_img) - функция для перевода из серо-чёрно-белого изображения в только чёрно-белое (это помогло мне уменьшить количество фотогорафий в датасете, а также скорость распознавания деталей)
  2. serial_control.py:
     Подключаются три библиотеки: serial, ConfigParser, getLogger.
     Дальше идут важные функции и обьекты:
       1. serial_connection - создание COM подключению к Arduino.
       2. ClosePort() - функция, закрывающая COM подключение.
       3. serialSend(data) - функция, отправляющая сообщение data[1] по ключу data[0]. Параметр data имеет тип list
       4. onRead() - функция, которая читает данные с COM порта - занимается парсингом по ключам.
  3. steppers.py:
     Подключаются четыре библиотеки: configparser, 
